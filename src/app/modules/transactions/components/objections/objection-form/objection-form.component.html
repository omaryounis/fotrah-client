<form>
  <div class="form-row mb-0">
    @for (item of taskDataArray; track $index) { @if(item.value != null &&
    !item.key.toLocaleLowerCase().includes('description') ){
    <div class="form-group">
      <label for="key">{{ item.key | translate }}</label>
      <input
        pInputText
        id="key"
        name="key"
        aria-label="key"
        [value]="item.value"
        disabled
      />
    </div>
    } } 
   
    @if(taskData.operationsReview){
    <div class="form-group">
      <label for="operationsReview"> {{ "operational-mangment-review" | translate}} </label>
      <input
        pInputText
        id="operationsReview"
        name="operationsReview"
        [(ngModel)]="taskData.operationsReview"
        disabled
      />
    </div>
    }
  </div>
  @if (votes.length > 0 ) {
  <p-card class="p-2">
    <ng-template pTemplate="header">
      <div
        class="flex text-primary my-3 cursor-pointer"
        (click)="is_collapsed = !is_collapsed"
      >
        <label for="commitee" class="me-auto">{{
          "commitee-votes" | translate
        }}</label>
        <i
          class="pi my-auto"
          [ngClass]="{
            'pi-angle-double-down': !is_collapsed,
            'pi-angle-double-up': is_collapsed
          }"
        ></i>
      </div>
    </ng-template>

    @if (is_collapsed) { @for (item of votes; track $index) {
    <div class="grid grid-cols-4 gap-2 vote-section">
      <!-- <div class="form-group">
             <label for="key">{{ 'role' | translate }}</label>
             <label for="key">{{ item.roleName }}</label>
           </div> -->
      <div class="form-group">
        <label class="key">{{ "voter-name" | translate }}</label>
        <label for="key">{{ item.voterName }} ( {{ item.roleName }} )</label>
      </div>
      <div class="form-group">
        <label class="key">{{ "vote-date" | translate }}</label>
        <label for="key">{{ item.createdAt | date : "yy MMM dd" }}</label>
      </div>
      <div class="form-group">
        <label class="key">{{ "Note" | translate }}</label>
        <label for="key">
          <ul style="list-style-type: circle" class="px-3">
            @for (res of splitString(item.comment); track $index) {
            <li>
              {{ res }}
            </li>
            }
          </ul>
        </label>
      </div>
      <div class="form-group grid-cols-1 flex">
        @if (item.vote) {
        <p-button
          [label]="'vote-accept' | translate"
          severity="primary"
          class="my-auto"
          [text]="true"
          badgeClass="p-badge-info"
        />
        }@else {
        <p-button
          [label]="'vote-reject' | translate"
          severity="danger"
          class="my-auto"
          [text]="true"
          badgeClass="p-badge-info"
        />
        }
      </div>
    </div>
    } }
  </p-card>
  } @for (attachment of attachments; track $index) {
  <label for="key">{{ getAttachmnetTitle(attachment.type) | translate }}</label>
  <div class="form-row">
    @for (item of attachment.data; track $index) {
    <div class="form-group file">
      <div
        class="mt-3 border-2 flex-[!important] border-gray-300 rounded-md p-2 pb-1"
      >
        <label
          [for]="'attachment_' + $index"
          class="w-full flex justify-between"
        >
          <span>{{
            item.filename ?? ("file" | translate) + ($index + 1)
          }}</span>

          <!-- <i
              class="pi pi-download my-auto w-[23px] ms-auto cursor-pointer text-primary"
              (click)="downloadFile(item.filePath, item.fileName , false )"
              severity="danger"
            ></i>
         -->

          <i
            class="pi pi-download my-auto w-[23px] ms-auto cursor-pointer text-primary"
            (click)="downloadFile(item.filePath, item.fileName, false)"
            severity="danger"
          ></i>
        </label>
      </div>
    </div>
    }
  </div>
  }
  <!-- take action -->

  <!-- proceed request buttons -->
  @if(taskData.status ==
  ObjectionStatusTypes.Under_Review_by_Comittee_Coordinator){
  @if(this.taskData.currentStatus !=
  ObjectionStatusTypes.Under_Operational_Review.toString()) {
  <div class="form-row !grid-cols-1 mt-2">
    <div class="form-gruop">
      <!-- <div class="form-row"> -->
      <p-fileUpload
        id="file-upload-input"
        mode="advanced"
        [chooseLabel]="'select-file' | translate"
        chooseIcon="pi pi-upload"
        [cancelLabel]="'cancel' | translate"
        (onSelect)="onFileUpload($event)"
        (onClear)="clearAllFiles()"
        (onRemove)="onFileRemove($event)"
        type="file"
        [showUploadButton]="false"
        [fileLimit]="3"
        [files]="taskData.uploadedFiles"
        cance
      >
      </p-fileUpload>
    </div>
  </div>

  }
  
  <div class="flex flex-wrap form-group gap-3">
    <div class="flex align-items-center">
      <p-radioButton
        name="currentStatus"
        [value]="ObjectionStatusTypes.Under_Evaluation"
        [(ngModel)]="taskData.currentStatus"
        (ngModelChange)="updateData()"
        inputId="ingredient1"
      />
      <label for="ingredient1" class="ms-2">
        {{ "proceed" | translate }}
      </label>
    </div>
  
    <!-- @if(taskData.lastStatus == 3){ -->
      <!-- <label for="finCategoryName"> Comming from the Members </label> -->

      <!-- <div class="card">
        <p-messages 
      [value]="[{severity:'warning', detail:'Comming from the Members'}]" 
      [enableService]="false" 
      [closable]="false" />
    </div> -->
   
<!-- } -->
    @if((!hasOperationsReview))
    {
      <div class="flex align-items-center">
        <p-radioButton
          name="currentStatus"
          [value]="ObjectionStatusTypes.Under_Operational_Review"
          [(ngModel)]="taskData.currentStatus"
          (ngModelChange)="updateData()"
          inputId="ingredient3"
        />
        <label for="ingredient3" class="ms-2">
          {{ "send-to-operations" | translate }}
        </label>
      </div>
    }
   
  </div>

 
  <!-- operational mangment -->
  } @if(taskData.status == ObjectionStatusTypes.Under_Operational_Review) {
  <div class="flex flex-wrap form-group gap-3">
    <div class="flex align-items-center">
      <p-radioButton
        name="currentStatus"
        [value]="taskData.lastStatus == 3 ? ObjectionStatusTypes.Under_Evaluation : ObjectionStatusTypes.Under_Review_by_Comittee_Coordinator"
        [(ngModel)]="taskData.currentStatus"
        (ngModelChange)="updateData()"
        inputId="ingredient5"
      />
      <label for="ingredient5" class="ms-2">
        {{ "send-to-objection-committee" | translate }}
      </label>
    </div>
  </div>
  <div class="form-row !grid-cols-1 mt-2">
    <div class="form-group">
      <label for="key">{{ "Note" | translate }}</label>
      <div class="rounded-md" pInputTextarea>
        <textarea
          id="description"
          name="description"
          aria-label="description"
          class="b-none w-full"
          #objectionReason="ngModel"
          [(ngModel)]="taskData.operationsReview"
          rows="5"
          maxlength="255"
        >
        </textarea>
      </div>
    </div>
  </div>
  <!-- attachment -->
  <div class="form-row !grid-cols-1 mt-2">
    <div class="form-gruop">
      <!-- <div class="form-row"> -->
      <p-fileUpload
        id="file-upload-input"
        mode="advanced"
        [chooseLabel] = "'select-file' | translate"
        chooseIcon="pi pi-upload"
        [cancelLabel]="'cancel' | translate"
        (onSelect)="onFileUpload($event)"
        (onClear)="clearAllFiles()"
        (onRemove) = "onFileRemove($event)"
        type="file" 
        [showUploadButton]="false"
        [fileLimit]="3"
        [files]="taskData.uploadedFiles"
        cance
        >
      </p-fileUpload>

    </div>
  </div>
  @if(taskData.lastStatus == 3){
    <div class="form-row !grid-cols-1 mt-2">
      <p-messages 
      [ngClass]="{'p-messages-new': true}" 
      [value]="[{severity:'new', detail:'Comming from the Members'}]" 
      [enableService]="false" 
      [closable]="false"
      >
        <ng-template pTemplate>
             <i class="pi pi-exclamation-circle text-orange-500"></i>
          <div class="custom-label">{{"returned-back-from-members"| translate}}</div>
        </ng-template>
    </p-messages>
    </div>
  
}
  
}
  

  <!-- voting buttons -->
  @if(taskData.status == ObjectionStatusTypes.Under_Evaluation){
  <div class="flex flex-wrap form-group gap-3">
    <div class="flex align-items-center">
      <p-radioButton
        name="currentStatus"
        [value]="ObjectionStatusTypes.Accepted"
        [(ngModel)]="taskData.currentStatus"
        (ngModelChange)="updateData()"
        #currentStatus="ngModel"
        inputId="ingredient1"
        required
      />
      <label for="ingredient1" class="ms-2">
        {{ "vote-accept" | translate }}
      </label>
    </div> 
    <div class="flex align-items-center">
      <p-radioButton
        name="currentStatus"
        [value]="ObjectionStatusTypes.Rejected"
        [(ngModel)]="taskData.currentStatus"
        (ngModelChange)="updateData()"
        inputId="ingredient2"
        #currentStatus="ngModel"
        required
      />
      <label for="ingredient2" class="ms-2">
        {{ "vote-reject" | translate }}
      </label>
    </div>
    <!-- sending to operations button if not sent before -->
    <!-- @if((!hasOperationsReview)){ -->
     <!-- <div class="flex align-items-center">
      <p-radioButton  
        name="currentStatus"
        [value]="ObjectionStatusTypes.Under_Operational_Review"
        [(ngModel)]="taskData.currentStatus"
        (ngModelChange)="updateData()"
        inputId="coordinatorBtn"
        #currentStatus="ngModel"
        required
      />
      <label for="coordinatorBtn" class="ms-2">
        {{ "send-to-operations" | translate }}
      </label>
    </div> -->
  <!-- } -->
    @if(isCoordinator()){
    <div class="flex align-items-center">
      <p-radioButton
        name="currentStatus"
        value="end-vote"
        [(ngModel)]="taskData.currentStatus"
        (ngModelChange)="updateData()"
        #currentStatus="ngModel"
        inputId="ingredient3"
        required
      />

      <label for="ingredient3" class="ms-2">
        {{ "end-vote" | translate }}
      </label>
    </div>
    

    }
    
 <!-- sending to operations button if not sent before -->
 
    <!-- @if (!this.taskData.currentStatus) {
    <div class="text-red-600">
      @if (objectionReason.errors?.['required']) {
      <span> {{ "this-field-required" | translate }}</span> }
    </div> -->
    <!-- } -->
  </div>
  @if((!(hasOperationsReview && isCoordinator()))){
    <div class="form-row !grid-cols-1 mt-2">
      <div class="form-group">
    <div class="flex align-items-center">
     <p-radioButton  
       name="currentStatus"
       [value]="ObjectionStatusTypes.Under_Operational_Review"
       [(ngModel)]="taskData.currentStatus"
       (ngModelChange)="updateData()"
       inputId="coordinatorBtn"
       #currentStatus="ngModel"
       required
     />
     <label for="coordinatorBtn" class="ms-2">
       {{ "send-to-operations" | translate }}
     </label>
   </div>
      </div>
  </div>
  }
  @if(taskData.currentStatus != ObjectionStatusTypes.Under_Operational_Review.toString()){
    <div class="form-row !grid-cols-1 mt-2">
      <div class="form-group">
        <label for="key">{{
          is_voting
            ? ("objection-reason" | translate)
            : ("proceed-reason" | translate)
        }}</label>
        <p-multiSelect
          name="objection-reason"
          class="w-full"
          [showHeader]="false"
          [filter]="false"
          id="close-icon"
          (onChange)="updateData()"
          [(ngModel)]="taskData.reasons"
          [showClear]="false"
          [defaultLabel]="'choose' | translate"
          [options]="vote_reasons"
          [optionLabel]="'name'"
          [optionValue]="'name'"
          optionLabel="name"
        ></p-multiSelect>
      </div>
    </div>
    <div class="form-row !grid-cols-1 mt-2">
      <div class="form-group">
        <label for="key">{{ "Note" | translate }}</label>
        <div class="rounded-md" pInputTextarea>
          <ul style="list-style-type: circle" class="px-3">
            @for (item of taskData.reasons; track $index) {
            <li>{{ item }}</li>
            }
          </ul>
          <textarea
            id="description"
            name="description"
            aria-label="description"
            class="b-none w-full"
            #objectionReason="ngModel"
            [(ngModel)]="taskData.objectionReason"
            rows="5"
            maxlength="255"
            [required]="taskData.reasons?.length == 0"
          >
          </textarea>
        </div>
        @if (objectionReason.invalid && (objectionReason.dirty ||
        objectionReason.touched)) {
        <div class="text-red-600">
          @if (objectionReason.errors?.['required']) {
          <span> {{ "this-field-required" | translate }}</span> }
        </div>
        }
      </div>
    </div>
  
  }

  } @if(taskData.status == ObjectionStatusTypes.Accepted){
  <div class="flex flex-wrap form-group gap-3">
    <div class="flex align-items-center">
      <p-radioButton
        name="currentStatus"
        [value]="ObjectionStatusTypes.Accepted"
        [(ngModel)]="taskData.currentStatus"
        (ngModelChange)="updateData()"
        inputId="ingredient1"
      />
      <label for="ingredient1" class="ms-2">
        {{ "accept-final-vote" | translate }}
      </label>
    </div>
  </div>
  }

  <!-- final approve -->
  @if ( taskData.status == ObjectionStatusTypes.Rejected) {
  <div class="form-row !grid-cols-1 mt-2">
    <div class="form-group">
      <label for="key">{{
        is_voting
          ? ("objection-reason" | translate)
          : ("proceed-reason" | translate)
      }}</label>
      <p-multiSelect
        name="objection-reason"
        class="w-full"
        [showHeader]="false"
        [filter]="false"
        id="close-icon"
        (onChange)="updateData()"
        [(ngModel)]="taskData.reasons"
        [showClear]="false"
        [defaultLabel]="'choose' | translate"
        [options]="vote_reasons"
        [optionLabel]="'name'"
        [optionValue]="'name'"
        optionLabel="name"
      ></p-multiSelect>
    </div>
  </div>
  <div class="form-row !grid-cols-1 mt-2">
    <div class="form-group">
      <label for="key">{{ "Note" | translate }}</label>
      <div class="rounded-md" pInputTextarea>
        <ul style="list-style-type: circle" class="px-3">
          @for (item of taskData.reasons; track $index) {
          <li>{{ item }}</li>
          }
        </ul>
        <textarea
          id="description"
          name="description"
          aria-label="description"
          class="b-none w-full"
          #objectionReason="ngModel"
          [(ngModel)]="taskData.objectionReason"
          rows="5"
          maxlength="255"
          [required]="taskData.reasons?.length == 0"
        >
        </textarea>
      </div>
      @if (objectionReason.invalid && (objectionReason.dirty ||
      objectionReason.touched)) {
      <div class="text-red-600">
        @if (objectionReason.errors?.['required']) {
        <span> {{ "this-field-required" | translate }}</span> }
      </div>
      }
    </div>
  </div>
  }
</form>
